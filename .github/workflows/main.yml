# 工作流的名称
name: Download Daily Bing Wallpaper

# 触发条件
on:
  # 1. 定时触发：使用 Cron 表达式
  # 这里的 '0 22 * * *' 代表每天在 UTC 时间 22:00 运行。
  # UTC 22:00 相当于北京时间第二天的早上 6:00，这个时间点可以确保获取到最新的壁纸。
  schedule:
    - cron: '0 22 * * *'

  # 2. 手动触发：允许您在 Actions 页面手动点击运行，方便测试
  workflow_dispatch:

# 任务
jobs:
  build:
    # 运行环境：使用最新的 Ubuntu 系统
    runs-on: ubuntu-latest

    # 步骤
    steps:
      # 第一步：检出（下载）您的代码到虚拟服务器
      - name: Checkout repository
        uses: actions/checkout@v4

      # 第二步：设置 Python 3.10 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 第三步：安装脚本所需的依赖库
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 第四步：运行您的 Python 脚本来下载图片
      - name: Run the download script
        run: python download_wallpaper.py

      # 第五步：将新下载的图片提交并推送到仓库
      - name: Commit and push the new wallpaper
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add daily-wallpaper.jpg # 添加这个被修改的文件
          # 使用 `|| exit 0` 来防止在没有新图片时（文件未变化）工作流报错
          git commit -m "Update daily wallpaper for $(date +'%Y-%m-%d')" || exit 0
          git push